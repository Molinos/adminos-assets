"use strict";var ActiveStorage=_interopRequireWildcard(require("activestorage"));function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};a.get||a.set?Object.defineProperty(t,n,a):t[n]=e[n]}return t.default=e,t}function initDatePicker(){$(".date-picker").datepicker({format:"yyyy-mm-dd",language:"ru",todayHighlight:!0,startDate:"1999-01-01",endDate:"+1m"}).on("changeDate",function(e){$(".input-date-field input").val(e.date)})}function setDate(){var e=$(".input-date-field input").val();$(".date-picker").datepicker("setDate",e)}function initSelect(){$("select.select2it").each(function(){$(this).next(".select2-container").remove(),$(this).select2({theme:"bootstrap",tags:!0,allowClear:!0,placeholder:"Не задано",width:"100%"})})}ActiveStorage.start(),$(function(){$("form a.submit-form, form input.delete-button, form.remote button").on("click",function(e){e.preventDefault();var t=$(this).parents("form"),n=t.find(".confirm-message");return 0<n.length&&!confirm(n.val())||t.submit(),!1})}),$(function(){initDatePicker()}),$(window).on("turbolinks:load",function(){initDatePicker(),setDate()}),$(function(){initSelect()}),$(window).on("turbolinks:load",function(){initSelect()});var _cropperjs=_interopRequireDefault(require("cropperjs"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('img[data-toggle="cropp"]').forEach(function(e){var o=document.querySelector('input[name*="'+e.dataset.coord+'"]'),t=e.dataset.preview,n=e.dataset.aspectRatio;new _cropperjs.default(e,{aspectRatio:n,preview:t,maxContainerWidth:"200px",crop:function(e){var t=Math.round(e.detail.width),n=Math.round(e.detail.height),a=Math.round(e.detail.x),i=Math.round(e.detail.y);o.value=t+"x"+n+"+"+a+"+"+i}})})});var spinnerOpts={lines:11,length:5,width:2,radius:5,corners:1,rotate:0,color:"#fff",speed:1,trail:50,shadow:!1,hwaccel:!1,className:"spinner",zIndex:1e3,top:"auto",left:"auto"};$(function(){var t=this,e=null!=navigator.userAgent.match(/(iPhone|iPod|iPad|BlackBerry|Android|Windows Phone|Opera Mobi)/i),n="ontouchstart"in window||navigator.msMaxTouchPoints;$(document).bind("ajaxStart turbolinks:request-start uploadStart",function(){$("#activity").show().spin(spinnerOpts)}).bind("ajaxStop turbolinks:request-end uploadStop",function(){$("#activity").hide().spin(!1)}),$(document).on("click",".js-sidebar-toggle",function(e){e.preventDefault(),$(".page").toggleClass("sidebar-opened")}),$(document).on("click",".js-nav-group-toggle",function(e){e.preventDefault(),$(this).parent().toggleClass("opened")}),$(document).on("click",".nav__link",function(){$(".nav__item").removeClass("active"),$(this).closest(".nav__item").addClass("active")}),$(document).on("click",".nav__link",function(){var e=$(this).closest(".nav__group");$(".nav__group").not(e).removeClass("opened")}),$(document).on("change",".uploader__check input",function(){var e=$(this).closest(".uploader__item");$(this).is(":checked")?e.addClass("chosen"):e.removeClass("chosen")}),$(document).on("change",".js-file input",function(e){e.preventDefault();var t=this.value,n=this.nextElementSibling;t=t.replace(/.*[/\\]/,""),n.textContent=t}),$(document).on("click",".nav-tabs .nav-link, .nav-pills .nav-link",function(e){e.preventDefault(),$(this).tab("show")}),$(document).ready(function(){var e=$(".sidebar__header-content"),t=e.height();e.css("margin-top",-t)}),$(window).on("load turbolinks:load",function(){$(".sidebar").find(".nav__group .nav__item.active").each(function(){var e=$(t).closest(".nav__group");e.addClass("opened initial"),setTimeout(function(){e.removeClass("initial")},500)})}),$(document).ready(function(){$("textarea").autosize()}),$(window).on("turbolinks:load",function(){$("textarea").autosize(),$(".with-nested-sortable > ul").withNestedSortable(),$(".nested-list .add_fields").data("association-insertion-method","append").data("association-insertion-node",function(e){return e.parents(".nested-list").find(".nested-node")}),$(".sidebar .optiscroll").optiscroll({preventParentScroll:!0,forceScrollbars:!0}),e?$("body").addClass("mobile"):$("body").addClass("desktop"),n?$("body").addClass("touch"):$("body").addClass("notouch")})}),$(function(){document.querySelectorAll(".select_filter").forEach(function(e){e.addEventListener("change",function(e){var t=e.currentTarget,n=t.selectedOptions[0].value,a=t.nextSibling;a.name=a.name.replace(/(\[).+?(\])/g,"$1"+n+"$2")})}),document.querySelector(".filter-form").addEventListener("submit",function(e){var t=document.querySelector("#query");if(t){var n=document.createElement("input");n.type="hidden",n.name=t.name,n.value=t.value,e.currentTarget.appendChild(n)}return!0})});var _railsUjs=_interopRequireDefault(require("rails-ujs"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}_railsUjs.default.start(),$(function(){$(".with-nested-sortable > ul").withNestedSortable(),$("a.ajax-post").ajaxRequestLink(),$("a.ajax-delete").ajaxRequestLink({method:"delete"}),$("form.method-link-to").addLinkToSubmitForm(),$(".with-togglable-navigation .active a").tab("show"),$(".with-togglable-navigation a").click(function(e){e.preventDefault(),$(this).tab("show")}),$(".with-togglable-navigation *[data-toggle]").on("shown",function(e){$(e.target).addClass("active")}),$(".with-move-to").sortable({handle:".icon-move",stop:function(e,t){var n=t.item.prev().data("id"),a=t.item.data("href");$.post(a,{to:n})}}),$(".with-apply-sortable-order[data-sortable]").sortable({opacity:.6,helper:function(e,t){var n=$(t).find(".sortable-helper");return'<div class="helper" style="width: auto; height: auto">'+(0<n.size()?'<img src="'+$(n).attr("src")+'"/>':$(t).attr("data-placeholder"))+"</div>"},appendTo:"body",handler:"icon-move",items:$(this).attr("items"),stop:function(e,t){var n=$(this).attr("data-sortable");if(n){var a=$.map($(this).children(),function(e,t){return $(e).attr("data-id")});$.ajax({type:"post",dataType:"script",data:{id:a},url:n})}}})});var _spin=_interopRequireDefault(require("spin/dist/spin.min"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}spinnerOpts={lines:11,length:5,width:2,radius:5,corners:1,rotate:0,color:"#fff",speed:1,trail:50,shadow:!1,hwaccel:!1,className:"spinner",zIndex:1e3,top:"auto",left:"auto"};$(function(){$.fn.spin=function(){return this.each(function(){var e=$(this),t=e.data();t.spinner&&(t.spinner.stop(),delete t.spinner),!1!==spinnerOpts&&(t.spinner=new _spin.default($.extend({color:e.css("color")},spinnerOpts)).spin(this))}),this}}),$.fn.withNestedSortable=function(e){var t=$.extend({},$.fn.withNestedSortable.defaults,{maxLevels:$(this).attr("max-levels")}),n=$.extend({},t,e);$(this).nestedSortable({listType:"ul",opacity:.8,items:"li",tabSize:32,maxLevels:n.maxLevels,disableNesting:"no-nesting",forcePlaceholderSize:!0,placeholder:"placeholder",tolerance:"pointer",toleranceElement:"> div",handle:".-move",start:function(e,t){$(t.helper).addClass("dragging")},stop:function(e,t){var n=t.item;n.removeClass("dragging");n.attr("rel");var a=n.parents("li").attr("rel"),i=n.prev("li").first().attr("rel");null==a&&(a=void 0),null==i&&(i=void 0),data={_method:"PUT",prev_id:i,parent_id:a},$.ajax({async:!1,type:"POST",url:n.attr("href"),dataType:"script",data:data})}})},$.fn.withNestedSortable.defaults={maxLevels:0},$.fn.ajaxRequestLink=function(e){var a=$.extend({},{type:"POST",method:"post",confirmation:"Вы уверены?"},e);$(this).on("click",function(e){e.preventDefault();var t=$(this),n=$("meta[name=csrf-token]").attr("content");return"string"!=typeof n||$.ajax({type:a.type,url:t.attr("rel"),data:{authenticity_token:n,_method:a.method},beforeSend:function(e){if(t.is(".with-confirmation")&&!0!==window.confirm(a.confirmation))return!1},success:function(e){t.is(".disable-after-success")&&t.replaceWith($("<span>".concat(t.text(),"</span>")))}}),!1})},$.fn.addLinkToSubmitForm=function(){0<$(this).length&&$(this).each(function(){var e=$(this);if(0===e.find("a.submit-form").length){var t=$('<a class="submit-form" href="'.concat(e.attr("action"),'">').concat(e.attr("title"),"</a>"));e.append(t),e.attr("title","")}})},function(g){var e=0,_=function(){return(new Date).getTime()+e++},b=function(e){return"["+e+"]$1"},w=function(e){return"_"+e+"_$1"};g(document).on("click",".add_fields",function(e){e.preventDefault();var t=g(this),n=t.data("association"),a=t.data("associations"),i=t.data("association-insertion-template"),o=t.data("association-insertion-method")||t.data("association-insertion-position")||"before",r=t.data("association-insertion-node"),s=t.data("association-insertion-traversal"),c=parseInt(t.data("count"),10),l=new RegExp("\\[new_"+n+"\\](.*?\\s)","g"),d=new RegExp("_new_"+n+"_(\\w*)","g"),u=_(),p=i.replace(l,b(u)),f=[];for(p==i&&(l=new RegExp("\\[new_"+a+"\\](.*?\\s)","g"),d=new RegExp("_new_"+a+"_(\\w*)","g"),p=i.replace(l,b(u))),f=[p=p.replace(d,w(u))],c=isNaN(c)?1:Math.max(c,1),c-=1;c;)u=_(),p=(p=i.replace(l,b(u))).replace(d,w(u)),f.push(p),c-=1;var h,v,m,$=(v=s,m=t,(h=r)?"function"==typeof h?(v&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function."),h(m)):"string"==typeof h?v?m[v](h):"this"==h?m:g(h):void 0:m.parent());$&&0!=$.length||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct."),g.each(f,function(e,t){var n=g(t),a=jQuery.Event("cocoon:before-insert");if($.trigger(a,[n]),!a.isDefaultPrevented()){$[o](n);$.trigger("cocoon:after-insert",[n])}})}),g(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(e){var t=g(this),n=t.data("wrapper-class")||"nested-fields",a=t.closest("."+n),i=a.parent();e.preventDefault();var o=jQuery.Event("cocoon:before-remove");if(i.trigger(o,[a]),!o.isDefaultPrevented()){var r=i.data("remove-timeout")||0;setTimeout(function(){t.hasClass("dynamic")?a.detach():(t.prev("input[type=hidden]").val("1"),a.hide()),i.trigger("cocoon:after-remove",[a])},r)}}),g(document).on("ready page:load turbolinks:load",function(){g(".remove_fields.existing.destroyed").each(function(e,t){var n=g(this),a=n.data("wrapper-class")||"nested-fields";n.closest("."+a).hide()})})}(jQuery);